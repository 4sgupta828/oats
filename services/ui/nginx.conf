# Nginx configuration for the OATS UI

server {
  # Listen on port 80, the standard HTTP port
  listen 80;

  # The root directory where our static React files live
  root /usr/share/nginx/html;
  index index.html;

  # This is the rule for serving the React Single Page Application.
  # It tries to find a static file matching the URL, and if it can't,
  # it falls back to serving the main index.html file.
  location / {
    try_files $uri $uri/ /index.html;
  }

  # This is the API gateway. Any request to '/api/...' will be
  # forwarded to our backend service running on port 8000.
  # The name 'oats-backend-api' will be the name of our Kubernetes service.
  location /api/ {
    proxy_pass http://oats-backend-api:8000/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  }

  # This location handles the WebSocket connection for real-time updates.
  # It requires special headers to upgrade the HTTP connection to a WebSocket.
  location /socket.io/ {
    proxy_pass http://oats-backend-api:8000;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "Upgrade";
    proxy_set_header Host $host;
  }
}